<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Well You Tracker</title>
    <!-- Icon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèãÔ∏è</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%231e1e1e%22/><text x=%2250%22 y=%2250%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2270%22>üèãÔ∏è</text></svg>">

    <style>
        :root { --bg-color: #121212; --card-color: #1e1e1e; --primary-color: #cc0000; --text-color: #ffffff; --text-secondary: #a0a0a0; --accent-green: #00e676; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding-bottom: 100px; -webkit-tap-highlight-color: transparent; padding-top: env(safe-area-inset-top); }
        header { background-color: rgba(0,0,0,0.9); backdrop-filter: blur(10px); padding: 15px; display: flex; align-items: center; justify-content: center; border-bottom: 2px solid var(--primary-color); position: sticky; top: 0; z-index: 1000; height: 50px; }
        #back-btn { position: absolute; left: 15px; background: #333; border: none; color: white; font-size: 1.4rem; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: none; align-items: center; justify-content: center; font-weight: bold; }
        h1 { margin: 0; font-size: 1.1rem; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
        #start-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; padding: 20px; }
        .welcome-text { text-align: center; margin-bottom: 30px; }
        .welcome-text h2 { margin-bottom: 5px; color: var(--primary-color); }
        .big-btn { width: 100%; max-width: 350px; background: linear-gradient(145deg, #252525, #1e1e1e); border: 1px solid #333; border-left: 5px solid var(--primary-color); color: white; padding: 25px 20px; margin-bottom: 15px; border-radius: 12px; font-size: 1.5rem; font-weight: 800; cursor: pointer; display: flex; flex-direction: column; text-align: left; transition: transform 0.1s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .big-btn:active { transform: scale(0.98); }
        .big-btn span { font-size: 0.85rem; font-weight: normal; color: var(--text-secondary); margin-top: 5px; text-transform: none; }
        #workout-view { display: none; padding: 15px; max-width: 600px; margin: 0 auto; }
        .exercise-card { background-color: var(--card-color); border-radius: 16px; padding: 18px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .ex-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .ex-info { display: flex; flex-direction: column; }
        .ex-name { color: var(--text-color); font-weight: 800; font-size: 1.1rem; margin-bottom: 4px; } 
        .ex-device { font-size: 0.8rem; color: var(--primary-color); text-transform: uppercase; letter-spacing: 0.5px; font-weight: bold; }
        .set-row { display: grid; grid-template-columns: 30px 1fr 1fr 1fr; gap: 10px; align-items: center; margin-bottom: 15px; font-size: 0.9rem; }
        .set-label { font-weight: bold; color: #555; text-align: center; background: #252525; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .history-info { display: flex; flex-direction: column; justify-content: center; font-size: 0.75rem; color: #777; }
        .history-val { color: var(--accent-green); font-weight: bold; font-size: 0.9rem; }
        input { width: 100%; background-color: #121212; border: 1px solid #333; color: white; padding: 12px 5px; border-radius: 8px; text-align: center; font-size: 18px; font-weight: bold; outline: none; }
        input:focus { border-color: var(--primary-color); background-color: #1a1a1a; }
        .save-btn { background: linear-gradient(to right, #cc0000, #990000); color: white; border: none; width: 100%; padding: 20px; font-size: 1.2rem; font-weight: bold; border-radius: 12px; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 15px rgba(204, 0, 0, 0.4); }
        .reset-btn { background: transparent; border: 1px solid #444; color: #888; padding: 15px; width: 100%; margin-top: 20px; border-radius: 12px; cursor: pointer; }
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; left: 50%; bottom: 40px; transform: translateX(-50%); border: 1px solid var(--primary-color); z-index: 2000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); font-weight: bold; }
        #toast.show { visibility: visible; animation: fadein 0.3s, fadeout 0.3s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 40px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 40px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

<header>
    <button id="back-btn" onclick="goHome()">&#8592;</button>
    <h1 id="header-title">Well You Moers</h1>
</header>

<div id="start-screen">
    <div class="welcome-text"><h2>Let's Grow!</h2><p>Was zerst√∂ren wir heute?</p></div>
    <button class="big-btn" onclick="tryStart('push')">PUSH<span>Brust, Schulter, Trizeps<br><small>HS Incline, Iso Chest, Seitheben...</small></span></button>
    <button class="big-btn" onclick="tryStart('pull')">PULL<span>R√ºcken, Bizeps<br><small>High Row, Low Row, Curls...</small></span></button>
    <button class="big-btn" onclick="tryStart('legs')">LEGS<span>Beine, Bauch<br><small>Squat, HS Leg Press, Strecker...</small></span></button>
</div>

<div id="workout-view"><div id="workout-container"></div></div>
<div id="toast">‚úÖ Fortschritt gespeichert!</div>

<script>
    const workoutPlan = {
        push: [
            { id: "p1", name: "Schr√§gbankdr√ºcken", device: "HS Iso-Lateral Incline", sets: 4 },
            { id: "p2", name: "Brustpresse Flach", device: "HS Iso-Lateral Chest", sets: 3 },
            { id: "p3", name: "Schulterdr√ºcken", device: "HS Iso-Lateral Shoulder", sets: 3 },
            { id: "p4", name: "Seitheben", device: "Kurzhanteln", sets: 4 },
            { id: "p5", name: "Butterfly", device: "Matrix / Kabel", sets: 3 },
            { id: "p6", name: "Trizepsdr√ºcken", device: "Kabel (Seil)", sets: 3 }
        ],
        pull: [
            { id: "pl1", name: "Latzug Front", device: "HS Iso-Lateral High", sets: 4 },
            { id: "pl2", name: "Rudern Tief", device: "HS Iso-Lateral Low Row", sets: 4 },
            { id: "pl3", name: "Kabel-Rudern", device: "Sitzend V-Griff", sets: 3 },
            { id: "pl4", name: "Reverse Flys", device: "Maschine / KH", sets: 3 },
            { id: "pl5", name: "Bizeps Curls", device: "SZ-Stange", sets: 3 },
            { id: "pl6", name: "Hammer Curls", device: "Kurzhanteln", sets: 3 }
        ],
        legs: [
            { id: "l1", name: "Kniebeugen", device: "Power Rack", sets: 4 },
            { id: "l2", name: "Beinpresse 45¬∞", device: "HS Linear Leg Press", sets: 4 },
            { id: "l3", name: "Beinstrecker", device: "Matrix", sets: 3 },
            { id: "l4", name: "Beinbeuger", device: "Matrix Liegend", sets: 4 },
            { id: "l5", name: "Wadenheben", device: "Beinpresse", sets: 4 },
            { id: "l6", name: "Planks", device: "Matte", sets: 3 }
        ]
    };

    function tryStart(type) {
        try { localStorage.setItem('test', '1'); localStorage.removeItem('test'); startWorkout(type); } 
        catch (e) { alert("Privater Modus aktiv? Speichern funktioniert evtl. nicht."); startWorkout(type); }
    }

    function startWorkout(type) {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('workout-view').style.display = 'block';
        document.getElementById('back-btn').style.display = 'flex';
        document.getElementById('header-title').innerText = type.toUpperCase() + " SESSION";
        renderWorkout(type);
        window.scrollTo(0,0);
    }

    function goHome() {
        document.getElementById('workout-view').style.display = 'none';
        document.getElementById('start-screen').style.display = 'flex';
        document.getElementById('back-btn').style.display = 'none';
        document.getElementById('header-title').innerText = "Well You Moers";
    }

    function renderWorkout(type) {
        const container = document.getElementById('workout-container');
        container.innerHTML = '';

        workoutPlan[type].forEach(ex => {
            let setsHtml = '';
            for(let i=1; i <= ex.sets; i++) {
                let savedCurrent = {weight: '', reps: ''};
                try { savedCurrent = JSON.parse(localStorage.getItem(`wy_moers_curr_${ex.id}_s${i}`)) || {weight:'', reps:''}; } catch(e){}
                let historyData = null;
                try { historyData = JSON.parse(localStorage.getItem(`wy_moers_hist_${ex.id}_s${i}`)); } catch(e){}
                let histHtml = historyData ? `<span class="history-val">${historyData.weight}kg x ${historyData.reps}</span>` : `<span style="color:#444">-</span>`;

                setsHtml += `
                <div class="set-row">
                    <div class="set-label">${i}</div>
                    <div class="history-info">Letztes:<br>${histHtml}</div>
                    <input type="number" inputmode="decimal" placeholder="kg" id="${ex.id}_s${i}_w" value="${savedCurrent.weight}" onchange="autoSaveTemp('${ex.id}', ${i})">
                    <input type="number" inputmode="decimal" placeholder="Wdh" id="${ex.id}_s${i}_r" value="${savedCurrent.reps}" onchange="autoSaveTemp('${ex.id}', ${i})">
                </div>`;
            }
            container.innerHTML += `<div class="exercise-card"><div class="ex-header"><div class="ex-info"><span class="ex-name">${ex.name}</span><span class="ex-device">${ex.device}</span></div></div>${setsHtml}</div>`;
        });

        // WICHTIG: Die ID f√ºr den Button ist jetzt eindeutig
        container.innerHTML += `
            <div style="margin-top:30px; margin-bottom:50px;">
                <button id="finishBtn" class="save-btn" onclick="finishWorkout('${type}')">WORKOUT BEENDEN & SPEICHERN</button>
                <button class="reset-btn" onclick="clearInputs('${type}')">Reset (Nur Eingaben l√∂schen)</button>
            </div>`;
    }

    function autoSaveTemp(exId, setNum) {
        try {
            let w = document.getElementById(`${exId}_s${setNum}_w`).value;
            let r = document.getElementById(`${exId}_s${setNum}_r`).value;
            localStorage.setItem(`wy_moers_curr_${exId}_s${setNum}`, JSON.stringify({weight:w, reps:r}));
        } catch(e) { console.log("Fehler beim AutoSave: " + e); }
    }

    function finishWorkout(type) {
        // Visuelles Feedback sofort geben
        let btn = document.getElementById("finishBtn");
        if(btn) btn.innerText = "SPEICHERE...";

        setTimeout(() => {
            try {
                // Keine Confirm-Box mehr -> Speichert sofort
                workoutPlan[type].forEach(ex => {
                    for(let i=1; i <= ex.sets; i++) {
                        let wEl = document.getElementById(`${ex.id}_s${i}_w`);
                        let rEl = document.getElementById(`${ex.id}_s${i}_r`);
                        
                        if(wEl && rEl) {
                            let w = wEl.value;
                            let r = rEl.value;
                            // Speichern in History nur wenn Werte da sind
                            if(w && r) {
                                localStorage.setItem(`wy_moers_hist_${ex.id}_s${i}`, JSON.stringify({weight:w, reps:r}));
                            }
                            // L√∂schen der tempor√§ren Werte f√ºr n√§chsten Tag
                            localStorage.removeItem(`wy_moers_curr_${ex.id}_s${i}`);
                        }
                    }
                });

                // Toast anzeigen
                var toast = document.getElementById("toast");
                toast.className = "show";
                setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
                
                // Zur√ºck zum Start
                setTimeout(goHome, 1000);
            } catch (e) {
                alert("FEHLER beim Speichern: " + e.message);
                if(btn) btn.innerText = "FEHLER - NOCHMAL VERSUCHEN";
            }
        }, 100); // Kurze Verz√∂gerung damit der Button-Text sich √§ndern kann
    }

    function clearInputs(type) {
        if(!confirm("Eingaben l√∂schen?")) return;
        workoutPlan[type].forEach(ex => {
            for(let i=1; i <= ex.sets; i++) {
                let w = document.getElementById(`${ex.id}_s${i}_w`);
                let r = document.getElementById(`${ex.id}_s${i}_r`);
                if(w) w.value = '';
                if(r) r.value = '';
                localStorage.removeItem(`wy_moers_curr_${ex.id}_s${i}`);
            }
        });
    }
</script>
</body>
</html>
