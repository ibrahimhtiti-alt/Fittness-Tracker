<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#121212">
    <title>Well You Pro</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Oswald:wght@500;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí™</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23cc0000%22/><text x=%2250%22 y=%2250%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2270%22>üí™</text></svg>">

    <style>
        :root { 
            --bg-color: #0f0f0f; 
            --card-bg: #1a1a1a;
            --card-gradient: linear-gradient(145deg, #222222, #181818);
            --primary-color: #d50000; 
            --text-color: #f5f5f5; 
            --text-muted: #888; 
            --gold: #ffd700; 
            --green: #00e676; 
            --blue: #00e5ff;
            --input-bg: #2a2a2a;
            --font-main: 'Inter', sans-serif;
            --font-head: 'Oswald', sans-serif;
        }

        * { box-sizing: border-box; }

        body { 
            font-family: var(--font-main); 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            margin: 0; 
            padding-bottom: 120px; 
            -webkit-tap-highlight-color: transparent; 
            padding-top: env(safe-area-inset-top);
        }
        
        /* Glass Header */
        header { 
            background: rgba(15, 15, 15, 0.85); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            padding: 0 15px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            border-bottom: 1px solid rgba(255,255,255,0.05); 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            height: 60px; 
        }
        #header-title { 
            margin: 0; 
            font-family: var(--font-head);
            font-size: 1.2rem; 
            text-transform: uppercase; 
            letter-spacing: 1.5px; 
            flex-grow: 1; 
            text-align: center; 
        }
        button.icon-btn { background: none; border: none; color: white; font-size: 1.4rem; width: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* Progress Bar */
        #progress-container {
            position: fixed; top: 60px; left: 0; width: 100%; height: 4px; background: transparent; z-index: 999; display: none;
        }
        #progress-fill {
            height: 100%; background: var(--primary-color); width: 0%; transition: width 0.4s ease-out; box-shadow: 0 0 10px rgba(213, 0, 0, 0.5);
        }

        /* Views */
        .view-section { display: none; padding: 20px 15px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Start Screen */
        #start-screen { min-height: 80vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* Workout Cards */
        .big-btn { 
            width: 100%; max-width: 400px; background: var(--card-gradient); border: 1px solid #333; border-left: 4px solid var(--primary-color); 
            color: white; padding: 25px 20px; margin-bottom: 16px; border-radius: 16px; cursor: pointer; display: flex; flex-direction: column; 
            text-align: left; transition: transform 0.1s, box-shadow 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .big-btn:active { transform: scale(0.97); }
        .big-btn h3 { margin: 0; font-family: var(--font-head); font-size: 1.6rem; letter-spacing: 1px; }
        .big-btn span { font-size: 0.85rem; color: var(--text-muted); margin-top: 6px; font-weight: 400; }
        
        .secondary-btn { 
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #ddd; padding: 16px; width: 100%; max-width: 400px; 
            border-radius: 12px; margin-top: 25px; font-weight: 600; cursor: pointer; font-family: var(--font-main);
        }

        /* Exercise Cards */
        .exercise-card { 
            background: var(--card-gradient); border-radius: 18px; padding: 20px; margin-bottom: 24px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); 
            border: 1px solid rgba(255,255,255,0.03); transition: border-color 0.3s;
        }
        .exercise-card.completed { border-color: var(--green); box-shadow: 0 0 15px rgba(0, 230, 118, 0.1); }
        .ex-header { margin-bottom: 18px; }
        .ex-name { font-family: var(--font-head); font-size: 1.3rem; color: #fff; letter-spacing: 0.5px; }
        .ex-device { font-size: 0.75rem; color: var(--primary-color); text-transform: uppercase; font-weight: 700; display: block; margin-top: 2px; letter-spacing: 1px; }
        .note-input { width: 100%; background: rgba(0,0,0,0.2); border: none; border-bottom: 1px solid #333; color: #ccc; font-size: 0.85rem; padding: 8px 0; margin-top: 10px; font-family: var(--font-main); transition: border 0.3s; }
        .note-input:focus { outline: none; border-bottom-color: var(--primary-color); }

        /* Sets */
        .set-row { display: grid; grid-template-columns: 24px 1fr 1fr 1fr; gap: 12px; align-items: center; margin-bottom: 14px; }
        .set-num { font-size: 0.8rem; color: #555; font-weight: bold; text-align: center; font-family: var(--font-head); }
        .hist-btn { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 8px 4px; text-align: center; cursor: pointer; height: 100%; display: flex; flex-direction: column; justify-content: center; }
        .hist-label { font-size: 0.6rem; color: #666; text-transform: uppercase; margin-bottom: 2px; }
        .hist-val { color: #ccc; font-weight: 600; font-size: 0.8rem; }
        
        input[type="number"] { width: 100%; background: var(--input-bg); border: 2px solid transparent; color: white; padding: 14px 0; border-radius: 12px; text-align: center; font-size: 1.1rem; font-weight: 700; outline: none; font-family: var(--font-main); transition: all 0.2s; }
        input[type="number"]:focus { background: #333; border-color: var(--primary-color); transform: translateY(-1px); }
        .pr-glow { border-color: var(--gold) !important; color: var(--gold) !important; box-shadow: 0 0 15px rgba(255, 215, 0, 0.15); background: rgba(255, 215, 0, 0.05) !important; }

        .save-btn { background: linear-gradient(135deg, #d50000, #b71c1c); color: white; border: none; width: 100%; padding: 20px; font-size: 1.1rem; font-weight: 800; border-radius: 14px; cursor: pointer; box-shadow: 0 8px 20px rgba(213, 0, 0, 0.3); letter-spacing: 1px; text-transform: uppercase; font-family: var(--font-head); margin-top: 20px; }
        .reset-btn { background: transparent; border: none; color: #666; padding: 15px; width: 100%; margin-top: 10px; cursor: pointer; font-size: 0.9rem; text-decoration: underline; }

        /* --- NEW LOGBOOK DESIGN --- */
        .log-entry { 
            background: var(--card-gradient); 
            margin-bottom: 15px; 
            border-radius: 16px; 
            overflow: hidden; 
            border: 1px solid rgba(255,255,255,0.05); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .log-entry:active { transform: scale(0.99); }

        .log-header { 
            padding: 15px; 
            display: grid; 
            grid-template-columns: 50px 1fr 30px; 
            gap: 15px; 
            align-items: center; 
            cursor: pointer; 
        }

        /* Calendar Date Badge */
        .log-date-badge {
            background: #252525;
            border-radius: 8px;
            text-align: center;
            padding: 5px 0;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .log-month { font-size: 0.6rem; text-transform: uppercase; color: #888; font-weight: bold; letter-spacing: 1px; }
        .log-day { font-size: 1.2rem; font-weight: 800; color: white; font-family: var(--font-head); line-height: 1.1; }

        .log-info h4 { margin: 0; font-family: var(--font-head); font-size: 1.1rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .log-meta { font-size: 0.8rem; color: #666; margin-top: 4px; }
        
        .log-arrow { color: #444; font-size: 1.2rem; }

        /* Color Themes for Splits */
        .theme-push .log-info h4 { color: var(--primary-color); }
        .theme-pull .log-info h4 { color: var(--blue); }
        .theme-legs .log-info h4 { color: var(--gold); }
        
        /* Expanded Content */
        .log-content { display: none; padding: 0 15px 15px 15px; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05); }
        .log-ex-row { padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .log-ex-row:last-child { border: none; }
        .log-ex-name { font-weight: 600; color: #ddd; font-size: 0.95rem; margin-bottom: 6px; }
        
        /* Chips for Sets */
        .set-chips { display: flex; flex-wrap: wrap; gap: 6px; }
        .set-chip { 
            background: rgba(255,255,255,0.08); 
            border-radius: 4px; 
            padding: 3px 8px; 
            font-size: 0.75rem; 
            color: #aaa; 
            font-family: monospace; 
            border: 1px solid rgba(255,255,255,0.05);
        }
        .set-chip b { color: white; }


        /* Timer Bar */
        #timer-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(10px); border-top: 1px solid #333; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 2000; padding-bottom: max(15px, env(safe-area-inset-bottom)); }
        .timer-display { font-family: monospace; font-size: 1.6rem; font-weight: 700; color: white; letter-spacing: -1px; }
        .timer-active { color: var(--green); text-shadow: 0 0 10px rgba(0,230,118,0.4); }
        .timer-controls button { background: #333; border: none; color: white; padding: 10px 16px; border-radius: 8px; font-weight: 600; margin-left: 8px; font-size: 0.9rem; }

        /* Modal & Toast */
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); z-index: 3000; display: none; align-items: center; justify-content: center; }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; border: 1px solid #333; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .modal-btn { display: block; width: 100%; padding: 16px; margin-top: 12px; border-radius: 10px; border: 1px solid #333; background: #222; color: white; cursor: pointer; font-size: 1rem; font-weight: 600; }
        #toast { visibility: hidden; min-width: 220px; background-color: #222; color: #fff; text-align: center; border-radius: 50px; padding: 14px 20px; position: fixed; left: 50%; bottom: 90px; transform: translateX(-50%); border: 1px solid var(--green); z-index: 2500; font-weight: 600; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #toast.show { visibility: visible; animation: fadein 0.3s, fadeout 0.3s 2.5s; }
        @keyframes fadein { from {bottom: 50px; opacity: 0;} to {bottom: 90px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 90px; opacity: 1;} to {bottom: 50px; opacity: 0;} }
    </style>
</head>
<body>

<header>
    <button class="icon-btn" id="back-btn" onclick="goHome()" style="display:none;">&#8592;</button>
    <h1 id="header-title">WELL YOU MOERS</h1>
    <button class="icon-btn" id="settings-btn" onclick="toggleModal()">‚öôÔ∏è</button>
</header>

<div id="progress-container"><div id="progress-fill"></div></div>

<!-- START SCREEN -->
<div id="start-screen" class="view-section" style="display:flex;">
    <div style="text-align:center; margin-bottom:40px;">
        <h2 style="font-family:'Oswald'; font-size:2.5rem; margin:0; letter-spacing:2px; color:white;">LEVEL UP</h2>
        <p style="margin:5px 0 0 0; color:#666; font-size:0.9rem; text-transform:uppercase; letter-spacing:1px;">Dein Training. Deine Regeln.</p>
    </div>
    
    <button class="big-btn" onclick="tryStart('push')">
        <h3>PUSH</h3><span>Brust, Schulter, Trizeps</span>
    </button>
    <button class="big-btn" onclick="tryStart('pull')">
        <h3>PULL</h3><span>R√ºcken, Bizeps, Rear Delts</span>
    </button>
    <button class="big-btn" onclick="tryStart('legs')">
        <h3>LEGS</h3><span>Beine, Waden, Bauch</span>
    </button>
    
    <button class="secondary-btn" onclick="showCalendar()">üìÖ Verlauf & Logbuch</button>
</div>

<!-- WORKOUT VIEW -->
<div id="workout-view" class="view-section">
    <div id="workout-container"></div>
</div>

<!-- CALENDAR VIEW -->
<div id="calendar-view" class="view-section">
    <h2 style="text-align:center; font-family:'Oswald'; margin-bottom:25px; font-size:1.5rem;">LOGBUCH</h2>
    <div id="calendar-list"></div>
</div>

<!-- TIMER -->
<div id="timer-bar">
    <div class="timer-display" id="timer-val">00:00</div>
    <div class="timer-controls">
        <button onclick="addTime(30)">+30s</button>
        <button onclick="toggleTimer()" id="timer-btn">Start</button>
        <button onclick="resetTimer()" style="color:#ff5555">‚úñ</button>
    </div>
</div>

<!-- MODAL -->
<div id="modal-overlay">
    <div class="modal-content">
        <h3 style="font-family:'Oswald'; margin-top:0;">EINSTELLUNGEN</h3>
        <button class="modal-btn" onclick="downloadBackup()">üíæ Daten Sichern</button>
        <button class="modal-btn" onclick="document.getElementById('import-file').click()">üìÇ Daten Laden</button>
        <input type="file" id="import-file" style="display:none" onchange="importBackup(this)">
        <button class="modal-btn" style="background:transparent; border:none; color:#888; margin-top:20px;" onclick="toggleModal()">Schlie√üen</button>
    </div>
</div>

<div id="toast">‚úÖ Gespeichert!</div>

<script>
    // --- DATEN ---
    const workoutPlan = {
        push: [
            { id: "p1", name: "Schr√§gbankdr√ºcken", device: "HS Iso-Lateral Incline", sets: 4 },
            { id: "p2", name: "Brustpresse Flach", device: "HS Iso-Lateral Chest", sets: 3 },
            { id: "p3", name: "Schulterdr√ºcken", device: "HS Iso-Lateral Shoulder", sets: 3 },
            { id: "p4", name: "Seitheben", device: "Kurzhanteln", sets: 4 },
            { id: "p5", name: "Butterfly", device: "Matrix / Kabel", sets: 3 },
            { id: "p6", name: "Trizepsdr√ºcken", device: "Kabel (Seil)", sets: 3 }
        ],
        pull: [
            { id: "pl1", name: "Latzug Front", device: "HS Iso-Lateral High", sets: 4 },
            { id: "pl2", name: "Rudern Tief", device: "HS Iso-Lateral Low Row", sets: 4 },
            { id: "pl3", name: "Kabel-Rudern", device: "Sitzend V-Griff", sets: 3 },
            { id: "pl4", name: "Reverse Flys", device: "Maschine / KH", sets: 3 },
            { id: "pl5", name: "Bizeps Curls", device: "SZ-Stange", sets: 3 },
            { id: "pl6", name: "Hammer Curls", device: "Kurzhanteln", sets: 3 }
        ],
        legs: [
            { id: "l1", name: "Kniebeugen", device: "Power Rack", sets: 4 },
            { id: "l2", name: "Beinpresse 45¬∞", device: "HS Linear Leg Press", sets: 4 },
            { id: "l3", name: "Beinstrecker", device: "Matrix", sets: 3 },
            { id: "l4", name: "Beinbeuger", device: "Matrix Liegend", sets: 4 },
            { id: "l5", name: "Wadenheben", device: "Beinpresse", sets: 4 },
            { id: "l6", name: "Planks", device: "Matte", sets: 3 }
        ]
    };

    // --- NAVIGATION ---
    function tryStart(type) {
        try { localStorage.setItem('test', '1'); localStorage.removeItem('test'); startWorkout(type); } 
        catch (e) { alert("Privater Modus aktiv?"); startWorkout(type); }
    }

    function switchView(viewId) {
        document.querySelectorAll('.view-section').forEach(el => el.style.display = 'none');
        document.getElementById(viewId).style.display = 'block';
        if(viewId === 'start-screen') {
            document.getElementById('start-screen').style.display = 'flex';
            document.getElementById('back-btn').style.display = 'none';
            document.getElementById('header-title').innerText = "WELL YOU MOERS";
            document.getElementById('progress-container').style.display = 'none';
        } else {
            document.getElementById('back-btn').style.display = 'flex';
        }
        window.scrollTo(0,0);
    }

    function startWorkout(type) {
        switchView('workout-view');
        document.getElementById('header-title').innerText = type.toUpperCase() + " SESSION";
        document.getElementById('progress-container').style.display = 'block';
        renderWorkout(type);
    }

    function goHome() { switchView('start-screen'); }

    // --- WORKOUT LOGIC ---
    function renderWorkout(type) {
        const container = document.getElementById('workout-container');
        container.innerHTML = '';

        workoutPlan[type].forEach(ex => {
            const note = localStorage.getItem(`wy_note_${ex.id}`) || "";
            let setsHtml = '';
            
            for(let i=1; i <= ex.sets; i++) {
                let curr = {};
                try { curr = JSON.parse(localStorage.getItem(`wy_curr_${ex.id}_s${i}`)) || {w:'', r:''}; } catch(e){}
                let hist = null;
                try { hist = JSON.parse(localStorage.getItem(`wy_hist_${ex.id}_s${i}`)); } catch(e){}
                
                let histText = hist ? `${hist.w}kg √ó ${hist.r}` : "‚Äî";
                let histValW = hist ? hist.w : "";
                let histValR = hist ? hist.r : "";

                setsHtml += `
                <div class="set-row">
                    <div class="set-num">${i}</div>
                    <div class="hist-btn" onclick="copyHistory('${ex.id}', ${i}, '${histValW}', '${histValR}')">
                        <div class="hist-label">Last</div>
                        <div class="hist-val">${histText}</div>
                    </div>
                    <input type="number" inputmode="decimal" placeholder="kg" id="${ex.id}_s${i}_w" value="${curr.w}" 
                        oninput="checkPR('${ex.id}', ${i}, ${histValW || 0}, 'w')" 
                        onchange="inputChanged('${ex.id}', ${i})">
                    <input type="number" inputmode="decimal" placeholder="Wdh" id="${ex.id}_s${i}_r" value="${curr.r}" 
                        oninput="checkPR('${ex.id}', ${i}, ${histValR || 0}, 'r')" 
                        onchange="inputChanged('${ex.id}', ${i})">
                </div>`;
            }
            container.innerHTML += `
            <div class="exercise-card" id="card_${ex.id}">
                <div class="ex-header">
                    <div class="ex-name">${ex.name}</div>
                    <div class="ex-device">${ex.device}</div>
                    <input type="text" class="note-input" placeholder="Notiz (Sitz, Griff)..." value="${note}" onchange="saveNote('${ex.id}', this.value)">
                </div>
                ${setsHtml}
            </div>`;
        });
        
        container.innerHTML += `
            <div style="margin-top:40px; margin-bottom:100px;">
                <button id="finishBtn" class="save-btn" onclick="finishWorkout('${type}')">Training Abschliessen</button>
                <button class="reset-btn" onclick="clearInputs('${type}')">Eingaben l√∂schen</button>
            </div>`;
        
        setTimeout(() => { checkAllPRs(type); updateProgress(type); }, 100);
    }

    function inputChanged(exId, set) {
        autoSave(exId, set);
        let r = document.getElementById(`${exId}_s${set}_r`).value;
        startTimerIfNew(r);
        
        let type = 'push';
        if(exId.startsWith('pl')) type = 'pull';
        if(exId.startsWith('l')) type = 'legs';
        updateProgress(type);
    }

    function updateProgress(type) {
        let totalSets = 0;
        let filledSets = 0;
        
        workoutPlan[type].forEach(ex => {
            let exFilled = 0;
            for(let i=1; i<=ex.sets; i++) {
                totalSets++;
                let w = document.getElementById(`${ex.id}_s${i}_w`).value;
                let r = document.getElementById(`${ex.id}_s${i}_r`).value;
                if(w && r) { filledSets++; exFilled++; }
            }
            const card = document.getElementById(`card_${ex.id}`);
            if(exFilled === ex.sets) card.classList.add('completed');
            else card.classList.remove('completed');
        });

        let percent = (filledSets / totalSets) * 100;
        document.getElementById('progress-fill').style.width = percent + "%";
    }

    function copyHistory(exId, set, w, r) {
        if(!w && !r) return;
        document.getElementById(`${exId}_s${set}_w`).value = w;
        document.getElementById(`${exId}_s${set}_r`).value = r;
        let type = exId.startsWith('p') ? (exId.startsWith('pl') ? 'pull' : 'push') : 'legs';
        inputChanged(exId, set);
        showToast("Werte kopiert!");
        checkPR(exId, set, w, 'w'); checkPR(exId, set, r, 'r');
    }

    function autoSave(exId, set) {
        let w = document.getElementById(`${exId}_s${set}_w`).value;
        let r = document.getElementById(`${exId}_s${set}_r`).value;
        localStorage.setItem(`wy_curr_${exId}_s${set}`, JSON.stringify({w:w, r:r}));
    }

    function saveNote(exId, val) { localStorage.setItem(`wy_note_${exId}`, val); }

    function checkPR(exId, set, histVal, type) {
        let el = document.getElementById(`${exId}_s${set}_${type}`);
        let currentVal = parseFloat(el.value);
        if(histVal > 0 && currentVal > histVal) el.classList.add('pr-glow');
        else el.classList.remove('pr-glow');
    }

    function checkAllPRs(type) {
        workoutPlan[type].forEach(ex => { for(let i=1; i<=ex.sets; i++) {
            let hist = {};
            try { hist = JSON.parse(localStorage.getItem(`wy_hist_${ex.id}_s${i}`)) || {w:0, r:0}; } catch(e){}
            checkPR(ex.id, i, hist.w, 'w'); checkPR(ex.id, i, hist.r, 'r');
        }});
    }

    // --- CALENDAR RENDERER (NEU & VERBESSERT) ---
    function showCalendar() {
        switchView('calendar-view');
        document.getElementById('header-title').innerText = "VERLAUF";
        renderCalendar();
    }

    function renderCalendar() {
        const container = document.getElementById('calendar-list');
        container.innerHTML = '';
        let logs = [];
        try { logs = JSON.parse(localStorage.getItem('wy_workout_logs')) || []; } catch(e) {}
        
        if(logs.length === 0) {
            container.innerHTML = '<div style="text-align:center; color:#666; padding:40px;">Noch keine Eintr√§ge.<br>Geh trainieren! üí™</div>';
            return;
        }

        logs.sort((a, b) => new Date(b.date) - new Date(a.date));

        logs.forEach((log, index) => {
            const dateObj = new Date(log.date);
            // Formate
            const day = dateObj.getDate();
            const month = dateObj.toLocaleString('de-DE', { month: 'short' });
            
            // Stats berechnen
            const exCount = log.exercises.length;
            let totalSets = 0;
            log.exercises.forEach(e => totalSets += e.sets.length);

            // Theme Class
            let themeClass = "theme-push";
            if(log.type === "PULL") themeClass = "theme-pull";
            if(log.type === "LEGS") themeClass = "theme-legs";
            
            let detailsHtml = '';
            log.exercises.forEach(ex => {
                let chips = ex.sets.map(s => `<span class="set-chip"><b>${s.w}</b>kg √ó ${s.r}</span>`).join('');
                detailsHtml += `<div class="log-ex-row"><div class="log-ex-name">${ex.name}</div><div class="set-chips">${chips}</div></div>`;
            });

            container.innerHTML += `
                <div class="log-entry ${themeClass}">
                    <div class="log-header" onclick="toggleLog(${index})">
                        <div class="log-date-badge">
                            <span class="log-month">${month}</span>
                            <span class="log-day">${day}</span>
                        </div>
                        <div class="log-info">
                            <h4>${log.type}</h4>
                            <div class="log-meta">${exCount} √úbungen ¬∑ ${totalSets} S√§tze</div>
                        </div>
                        <div class="log-arrow" id="arrow-${index}">&#9656;</div>
                    </div>
                    <div class="log-content" id="log-${index}">
                        ${detailsHtml}
                    </div>
                </div>
            `;
        });
    }

    function toggleLog(id) {
        const content = document.getElementById(`log-${id}`);
        const arrow = document.getElementById(`arrow-${id}`);
        if(content.style.display === "block") {
            content.style.display = "none";
            arrow.innerHTML = "&#9656;"; // Pfeil rechts
        } else {
            content.style.display = "block";
            arrow.innerHTML = "&#9662;"; // Pfeil runter
        }
    }

    // --- FINISH ---
    function finishWorkout(type) {
        let btn = document.getElementById("finishBtn");
        if(btn) btn.innerText = "SPEICHERE...";

        setTimeout(() => {
            try {
                let sessionLog = { date: new Date().toISOString(), type: type.toUpperCase(), exercises: [] };

                workoutPlan[type].forEach(ex => {
                    let exData = { name: ex.name, sets: [] };
                    let hasData = false;
                    for(let i=1; i <= ex.sets; i++) {
                        let w = document.getElementById(`${ex.id}_s${i}_w`).value;
                        let r = document.getElementById(`${ex.id}_s${i}_r`).value;
                        if(w && r) {
                            localStorage.setItem(`wy_hist_${ex.id}_s${i}`, JSON.stringify({w:w, r:r}));
                            exData.sets.push({ s: i, w: w, r: r });
                            hasData = true;
                        }
                        localStorage.removeItem(`wy_curr_${ex.id}_s${i}`);
                    }
                    if(hasData) sessionLog.exercises.push(exData);
                });

                if(sessionLog.exercises.length > 0) {
                    let logs = JSON.parse(localStorage.getItem('wy_workout_logs')) || [];
                    logs.push(sessionLog);
                    localStorage.setItem('wy_workout_logs', JSON.stringify(logs));
                }

                showToast("Training gespeichert!");
                setTimeout(goHome, 1000);

            } catch(e) {
                alert("Fehler: " + e.message);
                if(btn) btn.innerText = "FEHLER";
            }
        }, 50);
    }

    function clearInputs(type) {
        if(!confirm("Wirklich alles l√∂schen?")) return;
        workoutPlan[type].forEach(ex => { for(let i=1; i <= ex.sets; i++) {
            document.getElementById(`${ex.id}_s${i}_w`).value = '';
            document.getElementById(`${ex.id}_s${i}_r`).value = '';
            localStorage.removeItem(`wy_curr_${ex.id}_s${i}`);
            checkPR(ex.id, i, 0, 'w'); checkPR(ex.id, i, 0, 'r');
        }});
        updateProgress(type);
    }

    // --- TIMER & MISC ---
    let timerInterval; let seconds = 0; let isRunning = false;
    function startTimerIfNew(val) { if(val && !isRunning) { seconds = 0; updateTimerDisplay(); toggleTimer(); } }
    function toggleTimer() {
        if(isRunning) { clearInterval(timerInterval); document.getElementById('timer-btn').innerText = "Start"; document.getElementById('timer-val').classList.remove('timer-active'); isRunning = false; }
        else { clearInterval(timerInterval); timerInterval = setInterval(() => { seconds++; updateTimerDisplay(); }, 1000); document.getElementById('timer-btn').innerText = "Stop"; document.getElementById('timer-val').classList.add('timer-active'); isRunning = true; }
    }
    function addTime(secs) { seconds += secs; updateTimerDisplay(); }
    function resetTimer() { clearInterval(timerInterval); seconds = 0; isRunning = false; updateTimerDisplay(); document.getElementById('timer-btn').innerText = "Start"; document.getElementById('timer-val').classList.remove('timer-active'); }
    function updateTimerDisplay() { let m = Math.floor(seconds / 60).toString().padStart(2, '0'); let s = (seconds % 60).toString().padStart(2, '0'); document.getElementById('timer-val').innerText = `${m}:${s}`; }

    function toggleModal() { const m = document.getElementById('modal-overlay'); m.style.display = (m.style.display === 'flex') ? 'none' : 'flex'; }
    function downloadBackup() { const data = JSON.stringify(localStorage); const blob = new Blob([data], {type: "application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = "well_you_backup.json"; document.body.appendChild(a); a.click(); document.body.removeChild(a); toggleModal(); }
    function importBackup(input) { const file = input.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = function(e) { try { const data = JSON.parse(e.target.result); Object.keys(data).forEach(k => { localStorage.setItem(k, data[k]); }); alert("Backup geladen!"); location.reload(); } catch(err) { alert("Fehler beim Laden."); } }; reader.readAsText(file); }
    function showToast(msg) { const t = document.getElementById("toast"); t.innerText = msg; t.className = "show"; setTimeout(() => t.className = t.className.replace("show", ""), 3000); }
</script>
</body>
</html>
